<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Baby CRM</title>
<style>
:root{--w:#FFF;--b:#1D1D1F;--g1:#86868B;--g2:#D2D2D7;--g3:#F5F5F7;--red:#FF3B30;--grn:#34C759;--blu:#007AFF;--org:#FF9500;--pnk:#FF6B8A;--vio:#AF52DE}
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:-apple-system,BlinkMacSystemFont,'Helvetica Neue',sans-serif;background:var(--w);color:var(--b);-webkit-font-smoothing:antialiased}
a{text-decoration:none;color:inherit}
.auth-screen{min-height:100vh;display:flex;align-items:center;justify-content:center;padding:48px}
.auth-box{text-align:center;max-width:400px}
.auth-box .logo{font-size:48px;margin-bottom:24px}
.auth-box h1{font-size:28px;font-weight:600;letter-spacing:-1px;margin-bottom:8px}
.auth-box .sub{font-size:15px;color:var(--g1);margin-bottom:32px;line-height:1.5}
.g-btn{display:inline-flex;align-items:center;gap:12px;padding:14px 32px;border-radius:14px;border:1px solid var(--g2);background:var(--w);font-size:16px;font-weight:500;cursor:pointer;font-family:inherit;transition:all .2s;color:var(--b)}
.g-btn:hover{border-color:var(--b);box-shadow:0 4px 20px rgba(0,0,0,.08)}
.g-btn svg{width:20px;height:20px}
.auth-err{color:var(--red);font-size:13px;margin-top:16px}

/* Onboarding Chat */
.ob-screen{min-height:100vh;background:var(--w);display:flex;flex-direction:column}
.ob-header{padding:20px 24px;border-bottom:1px solid var(--g2);display:flex;align-items:center;gap:12px}
.ob-header .ava{width:36px;height:36px;border-radius:50%;background:var(--b);display:flex;align-items:center;justify-content:center;font-size:16px}
.ob-header .name{font-size:15px;font-weight:600}
.ob-header .status{font-size:11px;color:var(--grn)}
.ob-chat{flex:1;max-width:600px;width:100%;margin:0 auto;padding:24px;overflow-y:auto;display:flex;flex-direction:column;gap:8px}
.ob-msg{max-width:80%;padding:12px 16px;border-radius:18px;font-size:14px;line-height:1.5;animation:msgIn .3s ease}
.ob-bot{align-self:flex-start;background:var(--g3);border-bottom-left-radius:4px}
.ob-user{align-self:flex-end;background:var(--blu);color:#fff;border-bottom-right-radius:4px}
.ob-typing{align-self:flex-start;background:var(--g3);border-radius:18px;border-bottom-left-radius:4px;padding:12px 18px;display:flex;gap:4px}
.ob-typing span{width:6px;height:6px;border-radius:50%;background:var(--g1);animation:blink 1.4s infinite}
.ob-typing span:nth-child(2){animation-delay:.2s}.ob-typing span:nth-child(3){animation-delay:.4s}
@keyframes blink{0%,100%{opacity:.3}50%{opacity:1}}
@keyframes msgIn{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:translateY(0)}}
.ob-input{max-width:600px;width:100%;margin:0 auto;padding:16px 24px;border-top:1px solid var(--g2)}
.ob-input input[type="text"],.ob-input input[type="date"]{width:100%;padding:12px 16px;border:1px solid var(--g2);border-radius:22px;font-size:14px;font-family:inherit;outline:none}
.ob-input input:focus{border-color:var(--blu)}
.ob-options{display:flex;flex-wrap:wrap;gap:8px;max-width:600px;width:100%;margin:0 auto;padding:8px 24px 16px}
.ob-opt{padding:10px 20px;border-radius:22px;border:1px solid var(--g2);background:var(--w);font-size:13px;font-weight:500;cursor:pointer;font-family:inherit;transition:all .2s}
.ob-opt:hover{border-color:var(--blu);color:var(--blu)}
.ob-opt.sel{background:var(--blu);color:#fff;border-color:var(--blu)}
.ob-opt.multi.sel{background:var(--b);border-color:var(--b);color:#fff}
.ob-send{padding:10px 24px;border-radius:22px;border:none;background:var(--blu);color:#fff;font-size:14px;font-weight:600;cursor:pointer;font-family:inherit;margin-top:8px;width:100%}
.ob-skip{text-align:center;margin-top:8px}
.ob-skip button{background:none;border:none;color:var(--g1);font-size:13px;cursor:pointer;font-family:inherit}
.ob-progress{max-width:600px;width:100%;margin:0 auto;padding:0 24px}
.ob-pbar{height:3px;background:var(--g3);border-radius:2px;overflow:hidden}
.ob-pfill{height:100%;background:var(--blu);border-radius:2px;transition:width .4s}

/* App Shell */
.app-nav{padding:12px 48px;max-width:1400px;margin:0 auto;display:flex;justify-content:space-between;align-items:center;border-bottom:1px solid var(--g2)}
.app-nav-left{display:flex;align-items:center;gap:24px}
.app-logo{font-size:16px;font-weight:700;letter-spacing:-.5px;display:flex;align-items:center;gap:6px}
.app-tabs{display:flex;gap:4px}
.app-tab{padding:8px 16px;border-radius:8px;font-size:13px;font-weight:500;cursor:pointer;color:var(--g1);transition:all .2s;border:none;background:none;font-family:inherit}
.app-tab.a{background:var(--b);color:var(--w);border-radius:20px}
.app-nav-right{display:flex;align-items:center;gap:12px}
.user-menu{position:relative}
.user-avatar{width:32px;height:32px;border-radius:50%;cursor:pointer;border:2px solid var(--g2)}
.user-avatar:hover{border-color:var(--b)}
.user-drop{position:absolute;right:0;top:40px;background:var(--w);border:1px solid var(--g2);border-radius:14px;padding:8px;min-width:220px;box-shadow:0 8px 30px rgba(0,0,0,.12);z-index:100}
.user-drop-item{display:flex;align-items:center;gap:10px;padding:10px 14px;border-radius:8px;font-size:13px;cursor:pointer;transition:background .15s}
.user-drop-item:hover{background:var(--g3)}
.user-drop-item.danger{color:var(--red)}
.user-drop-divider{height:1px;background:var(--g2);margin:4px 0}
.user-drop-info{padding:8px 14px;font-size:12px;color:var(--g1);line-height:1.5}
.user-drop-info strong{color:var(--b);font-weight:600}
.cnt{max-width:1400px;margin:0 auto;padding:24px 48px 60px}

/* Dashboard */
.dash-hello{font-size:28px;font-weight:600;letter-spacing:-1px;margin-bottom:4px}
.dash-sub{font-size:15px;color:var(--g1);margin-bottom:24px}
.dash-cards{display:grid;grid-template-columns:repeat(4,1fr);gap:14px;margin-bottom:24px}
.dash-card{background:var(--g3);border-radius:16px;padding:22px}
.dash-card .dc-label{font-size:11px;font-weight:600;color:var(--g1);letter-spacing:.5px;text-transform:uppercase;margin-bottom:6px}
.dash-card .dc-val{font-size:28px;font-weight:600;letter-spacing:-1px}
.dash-card .dc-sub{font-size:11px;color:var(--g1);margin-top:3px}
.dash-card.accent .dc-val{color:var(--blu)}
.dash-card.warn .dc-val{color:var(--red)}
.dash-card.good .dc-val{color:var(--grn)}
.pbar{background:var(--g3);border-radius:6px;height:6px;overflow:hidden;margin-bottom:24px}
.pfill{height:100%;background:var(--b);border-radius:6px;transition:width .5s}
.dash-section{margin-bottom:24px}
.dash-section-title{font-size:13px;font-weight:700;letter-spacing:1px;text-transform:uppercase;color:var(--g1);margin-bottom:12px}
.dash-upcoming .tc{background:var(--g3)}
.dash-cats{display:grid;grid-template-columns:repeat(2,1fr);gap:10px}
.dash-cat{background:var(--g3);border-radius:12px;padding:14px 16px;display:flex;align-items:center;gap:12px}
.dash-cat-icon{font-size:20px}
.dash-cat-info{flex:1}
.dash-cat-name{font-size:13px;font-weight:600}
.dash-cat-prog{font-size:11px;color:var(--g1)}
.dash-cat-bar{height:3px;background:var(--g2);border-radius:2px;margin-top:4px}
.dash-cat-fill{height:100%;background:var(--b);border-radius:2px}
.due-row{display:flex;gap:20px;margin-bottom:20px;align-items:center;flex-wrap:wrap}
.due-row label{font-size:12px;color:var(--g1);font-weight:500}
.due-row input[type="date"]{padding:5px 10px;border:1px solid var(--g2);border-radius:8px;font-size:12px;font-family:inherit;outline:none}
.wbadge{font-size:12px;font-weight:600;background:var(--g3);padding:3px 12px;border-radius:20px}
.odue{font-size:12px;font-weight:600;color:var(--red);background:#FFF0F0;padding:3px 12px;border-radius:20px}

/* Sync */
.sync-bar{display:flex;align-items:center;gap:8px;padding:8px 14px;border-radius:10px;margin-bottom:12px;font-size:12px}
.sync-bar.on{background:#F0FAF0;border:1px solid #C8E6C9;color:#2E7D32}
.sync-bar.off{background:#FFF8E1;border:1px solid #FFE082;color:#F57F17}
.sd{width:7px;height:7px;border-radius:50%}.sd.on{background:var(--grn);animation:pulse 2s infinite}.sd.off{background:var(--org)}
@keyframes pulse{0%,100%{opacity:1}50%{opacity:.4}}

/* Tracker controls */
.ctrls{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px;flex-wrap:wrap;gap:8px}
.ctrls-l,.ctrls-r{display:flex;gap:6px;flex-wrap:wrap;align-items:center}
.vb{padding:5px 14px;border-radius:8px;border:1px solid var(--g2);font-size:12px;font-weight:500;cursor:pointer;font-family:inherit;background:var(--w);color:var(--g1);transition:all .2s}
.vb.a{background:var(--b);color:var(--w);border-color:var(--b)}
.si{padding:6px 12px;border-radius:8px;border:1px solid var(--g2);font-size:12px;font-family:inherit;outline:none;width:150px;color:var(--b)}
.ba{padding:6px 14px;border-radius:8px;border:none;background:var(--b);color:var(--w);font-size:12px;font-weight:600;cursor:pointer;font-family:inherit}
.frow{display:flex;gap:5px;margin-bottom:8px;flex-wrap:wrap}
.fb{padding:4px 12px;border-radius:20px;font-size:11px;font-weight:500;cursor:pointer;font-family:inherit;border:1px solid var(--g2);background:var(--w);color:var(--g1);transition:all .2s}
.fb.a{background:var(--b);color:var(--w);border-color:var(--b)}
.af{background:var(--g3);border-radius:14px;padding:16px;margin-bottom:16px}
.af .atl{font-size:14px;font-weight:600;margin-bottom:12px}
.af input[type="text"],.af input[type="number"]{padding:7px 10px;border-radius:8px;border:1px solid var(--g2);font-size:12px;font-family:inherit;outline:none;background:var(--w)}
.af input[type="text"]{width:100%;margin-bottom:10px}
.af input[type="number"]{width:80px}
.af .rw{display:flex;gap:8px;flex-wrap:wrap;align-items:center}
.af select{padding:7px 10px;border-radius:8px;border:1px solid var(--g2);font-size:12px;font-family:inherit;background:var(--w)}
.btnp{padding:8px 20px;border-radius:10px;border:none;background:var(--b);color:var(--w);font-size:13px;font-weight:600;cursor:pointer;font-family:inherit}

/* Task Card */
.tc{background:var(--g3);border-radius:12px;padding:14px 16px;margin-bottom:6px;cursor:pointer;transition:all .2s;border:1px solid transparent}
.tc:hover{border-color:var(--g2)}.tc.od{border-left:3px solid var(--red)}.tc.dn{opacity:.5}
.tc-top{display:flex;align-items:flex-start;gap:10px}
.ck{width:20px;height:20px;min-width:20px;border-radius:5px;border:2px solid var(--g2);display:flex;align-items:center;justify-content:center;cursor:pointer;margin-top:1px;transition:all .15s}
.ck.done{background:var(--grn);border-color:var(--grn)}.ck.done span{color:#fff;font-size:11px;font-weight:700}
.ck.prog{background:var(--blu);border-color:var(--blu)}.ck.prog span{color:#fff;font-size:9px;font-weight:700}
.tc-bd{flex:1}.tc-tx{font-size:13px;font-weight:500;line-height:1.4}.tc-tx.done{color:var(--g1);text-decoration:line-through}
.tc-mt{display:flex;gap:5px;margin-top:6px;flex-wrap:wrap;align-items:center}
.bg{padding:2px 7px;border-radius:6px;font-size:10px;font-weight:600}
.bh{background:#FFF0F0;color:var(--red)}.bm{background:#FFF8E1;color:var(--org)}.bl{background:#E8F4FD;color:var(--blu)}
.bw{background:var(--g3);color:var(--g1);font-weight:500;border:1px solid var(--g2)}.bc{background:#F0FAF0;color:var(--grn)}
.ob2{width:22px;height:22px;border-radius:50%;font-size:9px;font-weight:700;display:flex;align-items:center;justify-content:center;color:#fff;flex-shrink:0}
.oj{background:var(--blu)}.ot{background:var(--pnk)}.obth{background:var(--g1)}
.tc-ar{font-size:10px;color:var(--g2);transition:transform .2s;margin-left:auto}.tc-ar.op{transform:rotate(180deg)}
.tc-ex{margin-top:12px;padding-top:12px;border-top:1px solid var(--g2)}
.tc-ex textarea{width:100%;min-height:50px;border:1px solid var(--g2);border-radius:8px;padding:8px;font-size:12px;font-family:inherit;background:var(--w);color:var(--b);resize:vertical;outline:none}
.tc-ex .er{display:flex;gap:8px;margin-top:8px;flex-wrap:wrap;align-items:center}
.tc-ex select,.tc-ex input[type="number"]{padding:5px 8px;border:1px solid var(--g2);border-radius:6px;font-size:11px;font-family:inherit;background:var(--w)}
.tc-ex input[type="number"]{width:80px}
.bd{background:none;border:1px solid var(--red);color:var(--red);padding:3px 12px;border-radius:6px;font-size:11px;cursor:pointer;font-family:inherit;margin-left:auto}
.cg{margin-bottom:20px}
.ch{display:flex;align-items:center;gap:8px;margin-bottom:8px}
.ch .ci{font-size:16px}.ch .cl{font-size:14px;font-weight:600;letter-spacing:-.3px}.ch .cc{font-size:11px;color:var(--g1)}
.cb{flex:1;height:3px;background:var(--g3);border-radius:2px}.cb-f{height:100%;border-radius:2px;background:var(--b);transition:width .3s}
.kan{display:grid;grid-template-columns:1fr 1fr 1fr;gap:12px}
.kcol{background:var(--g3);border-radius:14px;padding:14px;min-height:180px}
.kcol h3{font-size:12px;font-weight:700;letter-spacing:1px;text-transform:uppercase;color:var(--g1);margin-bottom:12px;display:flex;justify-content:space-between}
.kcol h3 span{background:var(--g2);width:22px;height:22px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:10px;color:var(--g1)}
.kcol .tc{background:var(--w)}
.kcol.drag-over{background:#EAEAED;outline:2px dashed var(--g2)}
.tc.dragging{opacity:.4}.tc[draggable="true"]{cursor:grab}
@media(max-width:768px){.kan{grid-template-columns:1fr}}
.tl{overflow-x:auto;padding-bottom:16px}.tl-tr{display:flex;gap:0;min-width:max-content}
.tl-mo{min-width:240px;width:240px;padding:0 6px;flex-shrink:0}
.tl-mh{padding:10px 14px;border-radius:10px 10px 0 0;text-align:center}
.tl-mh .mm{font-size:14px;font-weight:600}.tl-mh .mw{font-size:10px;color:var(--g1);margin-top:2px}
.tl-mh .mt{font-size:9px;font-weight:600;letter-spacing:1px;text-transform:uppercase;margin-top:3px;opacity:.7}
.tl-ln{width:100%;height:3px;background:var(--g2);margin-bottom:10px}.tl-lf{height:100%;background:var(--b);border-radius:2px}
.tl-ts{padding:4px}.tl-ts .tc{background:var(--w);margin-bottom:5px}
.tl-cur .tl-mh{background:var(--b);color:var(--w)}.tl-cur .tl-mh .mw,.tl-cur .tl-mh .mt{color:rgba(255,255,255,.6)}

/* Budget */
.bgt-cards{display:grid;grid-template-columns:repeat(4,1fr);gap:12px;margin-bottom:20px}
.bgt-card{background:var(--g3);border-radius:14px;padding:20px}
.bgt-card .bc-label{font-size:11px;font-weight:600;color:var(--g1);letter-spacing:.5px;text-transform:uppercase;margin-bottom:6px}
.bgt-card .bc-val{font-size:24px;font-weight:600;letter-spacing:-1px}
.bgt-card .bc-sub{font-size:11px;color:var(--g1);margin-top:3px}
.bgt-card.green .bc-val{color:var(--grn)}.bgt-card.red .bc-val{color:var(--red)}
.bgt-cat-grid{display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-bottom:24px}
.bgt-cat{background:var(--g3);border-radius:12px;padding:16px}
.bgt-cat-top{display:flex;justify-content:space-between;align-items:center;margin-bottom:6px}
.bgt-cat-name{font-size:13px;font-weight:600;display:flex;align-items:center;gap:6px}
.bgt-cat-amt{font-size:13px;font-weight:600}
.bgt-cat-bar{height:3px;background:var(--g2);border-radius:2px;margin-bottom:4px}
.bgt-cat-fill{height:100%;border-radius:2px}
.bgt-cat-detail{font-size:11px;color:var(--g1);display:flex;justify-content:space-between}
.bgt-section{margin-bottom:24px}
.bgt-section-title{font-size:12px;font-weight:700;letter-spacing:1.5px;text-transform:uppercase;color:var(--g1);margin-bottom:12px}
.bgt-item{display:flex;align-items:center;gap:12px;padding:12px 16px;background:var(--g3);border-radius:10px;margin-bottom:5px}
.bgt-item-name{flex:1;font-size:13px;font-weight:500}
.bgt-item-freq{font-size:11px;color:var(--g1);padding:2px 8px;background:var(--w);border-radius:20px;border:1px solid var(--g2)}
.bgt-item-amt{font-size:13px;font-weight:600;min-width:70px;text-align:right}
.bgt-item-del{background:none;border:none;color:var(--g2);cursor:pointer;font-size:15px}.bgt-item-del:hover{color:var(--red)}
.bgt-add{display:flex;gap:8px;flex-wrap:wrap;align-items:center;margin-bottom:20px}
.bgt-add input,.bgt-add select{padding:7px 10px;border:1px solid var(--g2);border-radius:8px;font-size:12px;font-family:inherit;background:var(--w);outline:none}
.bgt-add input[type="text"]{flex:1;min-width:180px}.bgt-add input[type="number"]{width:90px}
.bgt-proj{background:var(--g3);border-radius:14px;padding:20px;margin-bottom:20px}
.bgt-proj h3{font-size:14px;font-weight:600;margin-bottom:14px}
.bgt-proj-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:10px}
.bgt-proj-item{text-align:center;padding:14px;background:var(--w);border-radius:10px}
.bgt-proj-item .pv{font-size:20px;font-weight:600;letter-spacing:-1px}
.bgt-proj-item .pl{font-size:10px;color:var(--g1);margin-top:3px;font-weight:500;text-transform:uppercase;letter-spacing:.5px}

/* Modal */
.modal-overlay{position:fixed;inset:0;background:rgba(0,0,0,.4);z-index:200;display:flex;align-items:center;justify-content:center;padding:24px}
.modal{background:var(--w);border-radius:20px;max-width:480px;width:100%;max-height:80vh;overflow-y:auto;box-shadow:0 20px 60px rgba(0,0,0,.2)}
.modal-hdr{padding:24px 24px 0;display:flex;justify-content:space-between;align-items:center}
.modal-hdr h2{font-size:20px;font-weight:600;letter-spacing:-.5px}
.modal-close{width:32px;height:32px;border-radius:50%;border:none;background:var(--g3);font-size:16px;cursor:pointer;display:flex;align-items:center;justify-content:center;color:var(--g1)}
.modal-close:hover{background:var(--g2)}
.modal-body{padding:20px 24px 24px}
.member-card{display:flex;align-items:center;gap:14px;padding:14px 16px;background:var(--g3);border-radius:14px;margin-bottom:8px}
.member-photo{width:42px;height:42px;border-radius:50%;object-fit:cover;border:2px solid var(--g2)}
.member-photo-placeholder{width:42px;height:42px;border-radius:50%;background:var(--g2);display:flex;align-items:center;justify-content:center;font-size:16px;font-weight:700;color:var(--w)}
.member-info{flex:1}
.member-name{font-size:14px;font-weight:600}.member-email{font-size:12px;color:var(--g1)}
.member-role{font-size:10px;font-weight:600;color:var(--blu);text-transform:uppercase;letter-spacing:.5px;margin-top:2px}
.member-remove{padding:6px 14px;border-radius:8px;border:1px solid var(--red);background:none;color:var(--red);font-size:12px;cursor:pointer;font-family:inherit}
.member-remove:hover{background:var(--red);color:var(--w)}
.member-you{font-size:10px;font-weight:600;background:var(--g2);color:var(--g1);padding:2px 8px;border-radius:10px}
.invite-section{margin-top:20px;padding-top:20px;border-top:1px solid var(--g2)}
.invite-section-title{font-size:13px;font-weight:600;margin-bottom:8px}
.invite-section .sub2{font-size:12px;color:var(--g1);margin-bottom:10px;line-height:1.5}
.invite-row{display:flex;gap:8px}
.invite-row input{flex:1;padding:10px 14px;border:1px solid var(--g2);border-radius:10px;font-size:12px;font-family:monospace;outline:none;background:var(--g3)}
.invite-row button{padding:10px 20px;border-radius:10px;border:none;background:var(--b);color:var(--w);font-size:13px;font-weight:600;cursor:pointer;font-family:inherit}
.merge-section{margin-top:20px;padding-top:20px;border-top:1px solid var(--g2)}
.merge-section .sub2{font-size:12px;color:var(--g1);margin-bottom:10px;line-height:1.5}
.member-count{font-size:12px;color:var(--g1);margin-bottom:14px}
.partner-badge{display:inline-flex;align-items:center;gap:6px;padding:4px 12px;background:#F0FAF0;border-radius:20px;font-size:12px;font-weight:500;color:#2E7D32;cursor:pointer}
.partner-badge img{width:20px;height:20px;border-radius:50%}
.invite-banner{background:linear-gradient(135deg,#F0F4FF,#FFF0F7);border:1px solid #E0E4EE;border-radius:14px;padding:16px 20px;margin-bottom:16px;display:flex;align-items:center;justify-content:space-between;gap:16px;flex-wrap:wrap}
.invite-banner .ib-text{font-size:14px;font-weight:500}
.invite-banner .ib-text span{color:var(--g1);font-size:13px;font-weight:400;display:block;margin-top:2px}
.invite-link{display:flex;gap:8px}
.invite-link input{padding:8px 14px;border:1px solid var(--g2);border-radius:8px;font-size:12px;font-family:monospace;width:240px;outline:none;background:var(--w)}
.invite-link button{padding:8px 16px;border-radius:8px;border:none;background:var(--b);color:var(--w);font-size:12px;font-weight:600;cursor:pointer;font-family:inherit}
.empty{text-align:center;padding:50px;color:var(--g1);font-size:14px}
.ftr{text-align:left;padding:24px 48px;max-width:1400px;margin:0 auto;border-top:1px solid var(--g2);font-size:12px;color:var(--g1)}
.toast{position:fixed;top:20px;left:50%;transform:translateX(-50%);color:#fff;padding:10px 24px;border-radius:30px;font-size:13px;font-weight:600;z-index:300;box-shadow:0 4px 20px rgba(0,0,0,.15);font-family:inherit;animation:fio 2s ease forwards}
.toast.t1{background:var(--b)}.toast.t2{background:var(--grn)}
@keyframes fio{0%{opacity:0;transform:translateX(-50%) translateY(-10px)}15%{opacity:1;transform:translateX(-50%) translateY(0)}80%{opacity:1}100%{opacity:0}}
@media(min-width:1600px){
  .app-nav,.cnt,.ftr{max-width:1600px}
}
@media(max-width:1024px){
  .dash-cards{grid-template-columns:1fr 1fr}
  .bgt-cards{grid-template-columns:1fr 1fr}
}
@media(max-width:768px){
  .app-nav,.cnt,.ftr{padding-left:20px;padding-right:20px}
  .dash-cards,.bgt-cards{grid-template-columns:1fr 1fr}.bgt-cat-grid,.dash-cats{grid-template-columns:1fr}
  .bgt-proj-grid{grid-template-columns:1fr}.app-nav{flex-direction:column;gap:10px;align-items:flex-start}
  .kan{grid-template-columns:1fr}
  .app-tabs{flex-wrap:wrap}
  .invite-link{flex-direction:column}.invite-link input{width:100%}
}
</style>
</head>
<body>
<div id="app"></div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.9/babel.min.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-database-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-auth-compat.js"></script>
<script type="text/babel">
const{useState,useEffect,useCallback,useRef}=React;
const FC={apiKey:"AIzaSyBUXgjCFSrlqmMAQYQdNppxa6IfHVHfSD0",authDomain:"babycrmapp.firebaseapp.com",databaseURL:"https://babycrmapp-default-rtdb.firebaseio.com",projectId:"babycrmapp",storageBucket:"babycrmapp.firebasestorage.app",messagingSenderId:"518741093126",appId:"1:518741093126:web:57b535ec66d7ac7f550c87"};

const CATS=[
  {id:"medical",label:"Medical",icon:"\u{1F3E5}",color:"var(--red)"},
  {id:"ivf",label:"IVF & Fertility",icon:"\u{1FA7A}",color:"var(--vio)"},
  {id:"babyproof",label:"Baby Proofing",icon:"\u{1F512}",color:"var(--grn)"},
  {id:"apartment",label:"Apartment",icon:"\u{1F3E0}",color:"var(--org)"},
  {id:"buy",label:"Things to Buy",icon:"\u{1F6D2}",color:"var(--b)"},
  {id:"mental",label:"Mental Health",icon:"\u{1F9E0}",color:"var(--vio)"},
  {id:"finance",label:"Financial",icon:"\u{1F4B0}",color:"var(--grn)"},
  {id:"prep",label:"Partner Prep",icon:"\u{1F4DA}",color:"var(--org)"},
];
const SEED_SECRETS=[
  {id:1,text:"Weekly love note",done:false,notes:""},
  {id:2,text:"Prenatal massage gift — $120",done:false,notes:""},
  {id:3,text:"Babymoon trip — research destinations",done:false,notes:""},
  {id:4,text:"Push present — something meaningful",done:false,notes:""},
  {id:5,text:"Maternity photoshoot — book photographer",done:false,notes:""},
  {id:6,text:"Random flowers — just because",done:false,notes:""},
  {id:7,text:"Write a letter for delivery day",done:false,notes:""},
  {id:8,text:"Plan a surprise date night",done:false,notes:""},
];
const MONTHS=[{m:1,label:"Month 1",weeks:"Wk 1\u20134",tri:1},{m:2,label:"Month 2",weeks:"Wk 5\u20138",tri:1},{m:3,label:"Month 3",weeks:"Wk 9\u201313",tri:1},{m:4,label:"Month 4",weeks:"Wk 14\u201317",tri:2},{m:5,label:"Month 5",weeks:"Wk 18\u201322",tri:2},{m:6,label:"Month 6",weeks:"Wk 23\u201327",tri:2},{m:7,label:"Month 7",weeks:"Wk 28\u201331",tri:3},{m:8,label:"Month 8",weeks:"Wk 32\u201335",tri:3},{m:9,label:"Month 9",weeks:"Wk 36\u201340",tri:3}];
function w2m(w){if(w<=4)return 1;if(w<=8)return 2;if(w<=13)return 3;if(w<=17)return 4;if(w<=22)return 5;if(w<=27)return 6;if(w<=31)return 7;if(w<=35)return 8;return 9}

const SEED=[
  {id:1,cat:"medical",text:"Schedule first prenatal appointment",week:4,done:false,priority:"high",notes:"",owner:"both",cost:null,status:"todo"},
  {id:2,cat:"medical",text:"Research and choose OB-GYN or midwife",week:3,done:false,priority:"high",notes:"",owner:"both",cost:null,status:"todo"},
  {id:3,cat:"medical",text:"Start prenatal vitamins",week:2,done:false,priority:"high",notes:"",owner:"partner2",cost:30,status:"todo"},
  {id:4,cat:"medical",text:"Home pregnancy test",week:2,done:false,priority:"high",notes:"",owner:"both",cost:15,status:"todo"},
  {id:5,cat:"medical",text:"Review insurance maternity coverage",week:4,done:false,priority:"high",notes:"",owner:"both",cost:null,status:"todo"},
  {id:6,cat:"medical",text:"First ultrasound",week:8,done:false,priority:"high",notes:"",owner:"both",cost:200,status:"todo"},
  {id:7,cat:"medical",text:"Genetic screening options",week:10,done:false,priority:"medium",notes:"",owner:"both",cost:null,status:"todo"},
  {id:8,cat:"medical",text:"NT scan",week:12,done:false,priority:"medium",notes:"",owner:"both",cost:null,status:"todo"},
  {id:9,cat:"medical",text:"Anatomy scan (20-week)",week:20,done:false,priority:"high",notes:"",owner:"both",cost:300,status:"todo"},
  {id:10,cat:"medical",text:"Glucose tolerance test",week:26,done:false,priority:"medium",notes:"",owner:"partner2",cost:null,status:"todo"},
  {id:11,cat:"medical",text:"Tour hospital",week:30,done:false,priority:"medium",notes:"",owner:"both",cost:null,status:"todo"},
  {id:12,cat:"medical",text:"Pre-register at hospital",week:34,done:false,priority:"high",notes:"",owner:"partner1",cost:null,status:"todo"},
  {id:13,cat:"medical",text:"Discuss birth plan",week:32,done:false,priority:"high",notes:"",owner:"both",cost:null,status:"todo"},
  {id:14,cat:"medical",text:"Pack hospital bag",week:36,done:false,priority:"high",notes:"",owner:"both",cost:null,status:"todo"},
  {id:15,cat:"medical",text:"Install infant car seat",week:36,done:false,priority:"high",notes:"",owner:"partner1",cost:null,status:"todo"},
  {id:16,cat:"medical",text:"Choose a pediatrician",week:32,done:false,priority:"high",notes:"",owner:"both",cost:null,status:"todo"},
  {id:17,cat:"ivf",text:"Initial fertility consultation",week:1,done:false,priority:"high",notes:"",owner:"both",cost:300,status:"todo"},
  {id:18,cat:"ivf",text:"Fertility blood work & tests",week:1,done:false,priority:"high",notes:"",owner:"both",cost:500,status:"todo"},
  {id:19,cat:"ivf",text:"Discuss treatment options with RE",week:1,done:false,priority:"high",notes:"",owner:"both",cost:null,status:"todo"},
  {id:170,cat:"ivf",text:"Begin hormone injections",week:1,done:false,priority:"high",notes:"",owner:"partner2",cost:null,status:"todo"},
  {id:171,cat:"ivf",text:"Egg retrieval procedure",week:1,done:false,priority:"high",notes:"",owner:"partner2",cost:5000,status:"todo"},
  {id:172,cat:"ivf",text:"Embryo transfer",week:1,done:false,priority:"high",notes:"",owner:"partner2",cost:null,status:"todo"},
  {id:173,cat:"ivf",text:"Two-week wait & pregnancy test",week:2,done:false,priority:"high",notes:"",owner:"both",cost:null,status:"todo"},
  {id:174,cat:"ivf",text:"Research IVF financial assistance",week:1,done:false,priority:"medium",notes:"",owner:"both",cost:null,status:"todo"},
  {id:175,cat:"ivf",text:"Find IVF support community",week:1,done:false,priority:"medium",notes:"",owner:"both",cost:null,status:"todo"},
  {id:176,cat:"ivf",text:"Emotional check-in with partner",week:1,done:false,priority:"high",notes:"",owner:"both",cost:null,status:"todo"},
  {id:20,cat:"babyproof",text:"Audit home for sharp edges",week:28,done:false,priority:"medium",notes:"",owner:"partner1",cost:null,status:"todo"},
  {id:21,cat:"babyproof",text:"Install outlet covers",week:30,done:false,priority:"medium",notes:"",owner:"partner1",cost:20,status:"todo"},
  {id:22,cat:"babyproof",text:"Secure furniture to walls",week:30,done:false,priority:"high",notes:"",owner:"partner1",cost:40,status:"todo"},
  {id:23,cat:"babyproof",text:"Install baby gates",week:32,done:false,priority:"medium",notes:"",owner:"partner1",cost:80,status:"todo"},
  {id:24,cat:"babyproof",text:"Lock cabinets",week:30,done:false,priority:"high",notes:"",owner:"partner1",cost:25,status:"todo"},
  {id:25,cat:"babyproof",text:"Check smoke & CO detectors",week:28,done:false,priority:"high",notes:"",owner:"partner1",cost:null,status:"todo"},
  {id:30,cat:"apartment",text:"Start apartment hunting",week:6,done:false,priority:"high",notes:"",owner:"both",cost:null,status:"todo"},
  {id:31,cat:"apartment",text:"Research neighborhoods",week:4,done:false,priority:"high",notes:"",owner:"both",cost:null,status:"todo"},
  {id:36,cat:"apartment",text:"Execute the move",week:20,done:false,priority:"high",notes:"",owner:"both",cost:2000,status:"todo"},
  {id:37,cat:"apartment",text:"Set up nursery",week:24,done:false,priority:"high",notes:"",owner:"both",cost:500,status:"todo"},
  {id:40,cat:"buy",text:"Crib + mattress",week:24,done:false,priority:"high",notes:"",owner:"both",cost:350,status:"todo"},
  {id:41,cat:"buy",text:"Car seat",week:30,done:false,priority:"high",notes:"",owner:"both",cost:250,status:"todo"},
  {id:42,cat:"buy",text:"Stroller",week:24,done:false,priority:"high",notes:"",owner:"both",cost:400,status:"todo"},
  {id:43,cat:"buy",text:"Diapers stockpile",week:32,done:false,priority:"high",notes:"",owner:"both",cost:120,status:"todo"},
  {id:44,cat:"buy",text:"Baby monitor",week:30,done:false,priority:"medium",notes:"",owner:"partner1",cost:150,status:"todo"},
  {id:45,cat:"buy",text:"Bottles & warmer",week:30,done:false,priority:"medium",notes:"",owner:"both",cost:80,status:"todo"},
  {id:46,cat:"buy",text:"Breast pump",week:28,done:false,priority:"high",notes:"",owner:"partner2",cost:null,status:"todo"},
  {id:47,cat:"buy",text:"Swaddles & sleep sacks",week:32,done:false,priority:"medium",notes:"",owner:"both",cost:60,status:"todo"},
  {id:48,cat:"buy",text:"Onesies, socks, hats",week:30,done:false,priority:"medium",notes:"",owner:"both",cost:100,status:"todo"},
  {id:49,cat:"buy",text:"Changing pad & diaper bag",week:30,done:false,priority:"medium",notes:"",owner:"both",cost:90,status:"todo"},
  {id:54,cat:"buy",text:"Maternity pillow",week:16,done:false,priority:"medium",notes:"",owner:"partner1",cost:50,status:"todo"},
  {id:55,cat:"buy",text:"Create baby registry",week:12,done:false,priority:"medium",notes:"",owner:"both",cost:null,status:"todo"},
  {id:56,cat:"buy",text:"Nursery rocker/glider",week:26,done:false,priority:"medium",notes:"",owner:"both",cost:300,status:"todo"},
  {id:60,cat:"mental",text:"Research postpartum depression",week:20,done:false,priority:"high",notes:"",owner:"partner1",cost:null,status:"todo"},
  {id:62,cat:"mental",text:"Find couples therapist",week:8,done:false,priority:"medium",notes:"",owner:"both",cost:null,status:"todo"},
  {id:63,cat:"mental",text:"Schedule regular date nights",week:4,done:false,priority:"high",notes:"",owner:"both",cost:null,status:"todo"},
  {id:66,cat:"mental",text:"Plan sleep shifts",week:30,done:false,priority:"high",notes:"",owner:"both",cost:null,status:"todo"},
  {id:67,cat:"mental",text:"Discuss division of labor",week:28,done:false,priority:"high",notes:"",owner:"both",cost:null,status:"todo"},
  {id:100,cat:"finance",text:"Create baby budget",week:4,done:false,priority:"high",notes:"",owner:"both",cost:null,status:"todo"},
  {id:101,cat:"finance",text:"Update life insurance",week:8,done:false,priority:"high",notes:"",owner:"partner1",cost:null,status:"todo"},
  {id:102,cat:"finance",text:"Increase emergency fund",week:6,done:false,priority:"high",notes:"",owner:"both",cost:null,status:"todo"},
  {id:103,cat:"finance",text:"Research 529 plan",week:16,done:false,priority:"medium",notes:"",owner:"partner1",cost:null,status:"todo"},
  {id:104,cat:"finance",text:"Update wills & guardians",week:20,done:false,priority:"high",notes:"",owner:"both",cost:500,status:"todo"},
  {id:105,cat:"finance",text:"Review leave policies",week:4,done:false,priority:"high",notes:"",owner:"both",cost:null,status:"todo"},
  {id:107,cat:"finance",text:"Research childcare costs",week:16,done:false,priority:"high",notes:"",owner:"both",cost:null,status:"todo"},
  {id:108,cat:"finance",text:"Add baby to insurance (30-day window!)",week:38,done:false,priority:"high",notes:"",owner:"partner1",cost:null,status:"todo"},
  {id:110,cat:"prep",text:"Read 'The Expectant Father'",week:4,done:false,priority:"medium",notes:"",owner:"partner1",cost:15,status:"todo"},
  {id:111,cat:"prep",text:"Childbirth class",week:24,done:false,priority:"high",notes:"",owner:"both",cost:200,status:"todo"},
  {id:112,cat:"prep",text:"Infant CPR & first aid",week:28,done:false,priority:"high",notes:"",owner:"both",cost:null,status:"todo"},
  {id:116,cat:"prep",text:"Meal prep for postpartum",week:34,done:false,priority:"high",notes:"",owner:"partner1",cost:200,status:"todo"},
  {id:119,cat:"prep",text:"Notify work about leave",week:28,done:false,priority:"high",notes:"",owner:"partner1",cost:null,status:"todo"},
];
const SEED_BUDGET=[
  {id:1,name:"Hospital delivery",amount:5000,freq:"once",cat:"medical"},
  {id:2,name:"Prenatal visit copays",amount:30,freq:"monthly",cat:"medical"},
  {id:3,name:"Childcare",amount:1800,freq:"monthly",cat:"finance"},
  {id:4,name:"Diapers & wipes",amount:80,freq:"monthly",cat:"buy"},
  {id:5,name:"Formula/food",amount:150,freq:"monthly",cat:"buy"},
];

// ===== ONBOARDING WIZARD =====
function Onboarding({user,onComplete}){
  const[step,setStep]=useState(0);
  const[msgs,setMsgs]=useState([]);
  const[typing,setTyping]=useState(true);
  const[data,setData]=useState({name:"",partner:"",journey:"expecting",currentWeek:2,dueDate:"",apartment:"no",budget:"10-20k",categories:[],ivf:false,autoComplete:true});
  const[inputVal,setInputVal]=useState("");
  const[multiSel,setMultiSel]=useState([]);
  const chatRef=useRef(null);

  const steps=[
    {bot:"Hey! \u{1F44B} Welcome to Baby CRM. What should we call you?",type:"text",field:"name"},
    {bot:(d)=>`Nice to meet you, ${d.name}! What's your partner's name?`,type:"text",field:"partner"},
    {bot:"Where are you on your journey?",type:"options",field:"journey",opts:[
      {val:"trying",label:"\u{1F331} Trying to conceive"},
      {val:"ivf",label:"\u{1FA7A} IVF / Fertility treatment"},
      {val:"expecting",label:"\u{1F930} Currently expecting"},
      {val:"planning",label:"\u{1F4AD} Just exploring"},
    ]},
    {bot:(d)=>d.journey==="expecting"?"Amazing! How far along are you?":"Got it! Let's set things up for you.",type:"options",field:"currentWeek",skip:d=>d.journey!=="expecting",opts:[
      {val:4,label:"Month 1 (Wk 1\u20134)"},{val:8,label:"Month 2 (Wk 5\u20138)"},{val:13,label:"Month 3 (Wk 9\u201313)"},
      {val:17,label:"Month 4 (Wk 14\u201317)"},{val:22,label:"Month 5 (Wk 18\u201322)"},{val:27,label:"Month 6 (Wk 23\u201327)"},
      {val:31,label:"Month 7 (Wk 28\u201331)"},{val:35,label:"Month 8 (Wk 32\u201335)"},{val:40,label:"Month 9 (Wk 36\u201340)"},
    ]},
    {bot:"Do you know your due date yet?",type:"date",field:"dueDate",skip:d=>d.journey!=="expecting"},
    {bot:"Are you looking for a new place?",type:"options",field:"apartment",opts:[
      {val:"yes",label:"\u{1F50D} Yes, actively looking"},
      {val:"moved",label:"\u{1F4E6} Already moved"},
      {val:"no",label:"\u{1F3E0} Staying put"},
    ]},
    {bot:"What's your rough baby budget for the first year?",type:"options",field:"budget",opts:[
      {val:"<5k",label:"Under $5,000"},{val:"5-10k",label:"$5,000 \u2013 $10,000"},
      {val:"10-20k",label:"$10,000 \u2013 $20,000"},{val:"20k+",label:"$20,000+"},
      {val:"unsure",label:"\u{1F937} Not sure yet"},
    ]},
    {bot:"What matters most to you right now? Pick all that apply.",type:"multi",field:"categories",opts:[
      {val:"medical",label:"\u{1F3E5} Medical"},{val:"ivf",label:"\u{1FA7A} IVF/Fertility"},
      {val:"buy",label:"\u{1F6D2} Shopping"},{val:"babyproof",label:"\u{1F512} Baby Proofing"},
      {val:"apartment",label:"\u{1F3E0} Apartment"},{val:"mental",label:"\u{1F9E0} Mental Health"},
      {val:"finance",label:"\u{1F4B0} Finances"},{val:"prep",label:"\u{1F4DA} Partner Prep"},
    ]},
    {bot:(d)=>d.journey==="expecting"&&d.currentWeek>4?`Since you're already at Week ${d.currentWeek}, want us to auto-complete tasks from earlier weeks? You can always undo them later.`:"You're all set! Let's get planning \u{1F389}",
      type:"options",field:"autoComplete",skip:d=>d.journey!=="expecting"||d.currentWeek<=4,opts:[
      {val:true,label:"\u2705 Yes, mark earlier tasks done"},
      {val:false,label:"\u274C No, I'll review them myself"},
    ]},
  ];

  useEffect(()=>{showBotMsg(0)},[]);
  useEffect(()=>{if(chatRef.current)chatRef.current.scrollTop=chatRef.current.scrollHeight},[msgs,typing]);

  function showBotMsg(idx){
    if(idx>=steps.length){finish();return}
    let s=steps[idx];
    if(s.skip&&s.skip(data)){setStep(idx+1);showBotMsg(idx+1);return}
    setTyping(true);
    setTimeout(()=>{
      const txt=typeof s.bot==="function"?s.bot(data):s.bot;
      setMsgs(p=>[...p,{from:"bot",text:txt}]);
      setTyping(false);
      setStep(idx);
    },600);
  }

  function answer(val,label){
    setMsgs(p=>[...p,{from:"user",text:label||String(val)}]);
    const nd={...data,[steps[step].field]:val};
    setData(nd);
    setInputVal("");
    setMultiSel([]);
    const next=step+1;
    setTimeout(()=>{
      if(next>=steps.length){showBotMsg(next);return}
      let s=steps[next];
      while(s&&s.skip&&s.skip(nd)){
        const nn=steps.indexOf(s)+1;
        if(nn>=steps.length){finish(nd);return}
        s=steps[nn];
      }
      showBotMsg(steps.indexOf(s));
    },400);
  }

  function finish(d){
    const fd=d||data;
    setTyping(true);
    setTimeout(()=>{
      setMsgs(p=>[...p,{from:"bot",text:`Perfect, ${fd.name}! Your Baby CRM is ready. Let's do this! \u{1F680}`}]);
      setTyping(false);
      setTimeout(()=>onComplete(fd),1500);
    },600);
  }

  function handleTextSubmit(e){e.preventDefault();if(!inputVal.trim())return;answer(inputVal.trim())}
  function toggleMulti(val){setMultiSel(p=>p.includes(val)?p.filter(v=>v!==val):[...p,val])}

  const cs=steps[step];
  const progress=((step+1)/steps.length)*100;

  return(<div className="ob-screen">
    <div className="ob-header"><div className="ava">{"\u{1F476}"}</div><div><div className="name">Baby CRM</div><div className="status">Online</div></div></div>
    <div className="ob-progress"><div className="ob-pbar"><div className="ob-pfill" style={{width:`${progress}%`}}/></div></div>
    <div className="ob-chat" ref={chatRef}>
      {msgs.map((m,i)=><div key={i} className={`ob-msg ${m.from==="bot"?"ob-bot":"ob-user"}`}>{m.text}</div>)}
      {typing&&<div className="ob-typing"><span/><span/><span/></div>}
    </div>
    {!typing&&cs&&<>
      {cs.type==="text"&&<div className="ob-input"><form onSubmit={handleTextSubmit} style={{display:"flex",gap:8}}><input type="text" value={inputVal} onChange={e=>setInputVal(e.target.value)} placeholder="Type here..." autoFocus/><button type="submit" className="ob-send" style={{width:"auto",padding:"12px 20px"}}>Send</button></form></div>}
      {cs.type==="date"&&<div className="ob-input"><input type="date" value={inputVal} onChange={e=>setInputVal(e.target.value)} autoFocus/><button className="ob-send" onClick={()=>answer(inputVal,inputVal||"Set later")} style={{marginTop:8}}>Continue</button><div className="ob-skip"><button onClick={()=>answer("","Not sure yet")}>Skip for now</button></div></div>}
      {cs.type==="options"&&<div className="ob-options">{cs.opts.map(o=><button key={o.val} className="ob-opt" onClick={()=>answer(o.val,o.label)}>{o.label}</button>)}</div>}
      {cs.type==="multi"&&<><div className="ob-options">{cs.opts.map(o=><button key={o.val} className={`ob-opt multi${multiSel.includes(o.val)?" sel":""}`} onClick={()=>toggleMulti(o.val)}>{o.label}</button>)}</div><div className="ob-input"><button className="ob-send" onClick={()=>answer(multiSel,multiSel.map(v=>cs.opts.find(o=>o.val===v)?.label).join(", "))}>Continue</button></div></>}
    </>}
  </div>);
}

// ===== MAIN APP =====
function App(){
  const[user,setUser]=useState(null);const[loading,setLoading]=useState(true);const[authErr,setAuthErr]=useState("");
  const[needsOnboarding,setNeedsOnboarding]=useState(false);
  const[household,setHousehold]=useState(null);const[members,setMembers]=useState({});
  const[tasks,setTasks]=useState([]);const[budgetItems,setBudgetItems]=useState([]);const[dueDate,setDueDate]=useState("");const[profile,setProfile]=useState({});
  const[tab,setTab]=useState("home");const[trackerView,setTrackerView]=useState("board");
  const[cat,setCat]=useState("all");const[ofl,setOfl]=useState("all");const[q,setQ]=useState("");
  const[ao,setAo]=useState(false);const[exp,setExp]=useState(null);
  const[nt,setNt]=useState({cat:"medical",text:"",week:2,priority:"medium",notes:"",owner:"both",cost:""});
  const[nb,setNb]=useState({name:"",amount:"",freq:"once",cat:"medical"});
  const[secretTasks,setSecretTasks]=useState([]);
  const[secretInput,setSecretInput]=useState("");
  const[conn,setConn]=useState(false);const[showMenu,setShowMenu]=useState(false);const[showMembers,setShowMembers]=useState(false);const[showSettings,setShowSettings]=useState(false);
  const[copied,setCopied]=useState(false);const[dragId,setDragId]=useState(null);const[dragOver,setDragOver]=useState(null);
  const[mergeCode,setMergeCode]=useState("");
  const sk=useRef(false);const bsk=useRef(false);const dbRef=useRef(null);

  useEffect(()=>{
    if(!FC.apiKey){setLoading(false);return}
    try{
      if(!firebase.apps.length)firebase.initializeApp(FC);
      const auth=firebase.auth();
      const params=new URLSearchParams(window.location.search);
      const inviteHH=params.get("invite");
      auth.onAuthStateChanged(async(u)=>{
        if(u){
          setUser(u);const db=firebase.database();dbRef.current=db;
          db.ref(".info/connected").on("value",s=>setConn(s.val()===true));
          const snap=await db.ref(`users/${u.uid}/householdId`).once("value");
          let hhId=snap.val();
          if(inviteHH&&!hhId){
            hhId=inviteHH;
            await db.ref(`users/${u.uid}/householdId`).set(hhId);
            await db.ref(`households/${hhId}/members/${u.uid}`).set({name:u.displayName||"Partner",email:u.email,photo:u.photoURL||""});
            window.history.replaceState({},"",window.location.pathname);
          }else if(!hhId){
            setNeedsOnboarding(true);setLoading(false);return;
          }
          setHousehold(hhId);
          db.ref(`households/${hhId}/members`).on("value",s=>{const v=s.val();if(v)setMembers(v)});
          db.ref(`households/${hhId}/tasks`).on("value",s=>{if(sk.current){sk.current=false;return}const v=s.val();if(v&&Array.isArray(v))setTasks(v)});
          db.ref(`households/${hhId}/budget`).on("value",s=>{if(bsk.current){bsk.current=false;return}const v=s.val();if(v&&Array.isArray(v))setBudgetItems(v)});
          db.ref(`households/${hhId}/dueDate`).on("value",s=>{const v=s.val();if(v)setDueDate(v)});
          db.ref(`households/${hhId}/profile`).on("value",s=>{const v=s.val();if(v)setProfile(v)});
          db.ref(`users/${u.uid}/secrets`).on("value",s=>{const v=s.val();if(v&&Array.isArray(v))setSecretTasks(v)});
        }
        setLoading(false);
      });
    }catch(e){setLoading(false)}
  },[]);

  async function completeOnboarding(data){
    const db=firebase.database();dbRef.current=db;
    const u=firebase.auth().currentUser;
    const hhId=u.uid;
    await db.ref(`users/${u.uid}/householdId`).set(hhId);
    await db.ref(`households/${hhId}/members/${u.uid}`).set({name:u.displayName||data.name,email:u.email,photo:u.photoURL||""});
    // Filter tasks based on onboarding
    let seedTasks=[...SEED];
    if(data.journey!=="ivf"&&!data.categories.includes("ivf"))seedTasks=seedTasks.filter(t=>t.cat!=="ivf");
    if(data.apartment==="no"||data.apartment==="moved")seedTasks=seedTasks.filter(t=>t.cat!=="apartment");
    // Auto-complete earlier tasks
    if(data.autoComplete&&data.journey==="expecting"&&data.currentWeek>4){
      seedTasks=seedTasks.map(t=>t.week<data.currentWeek?{...t,status:"done",done:true}:t);
    }
    await db.ref(`households/${hhId}/tasks`).set(seedTasks);
    await db.ref(`households/${hhId}/budget`).set(SEED_BUDGET);
    await db.ref(`users/${u.uid}/secrets`).set(SEED_SECRETS);
    if(data.dueDate)await db.ref(`households/${hhId}/dueDate`).set(data.dueDate);
    await db.ref(`households/${hhId}/profile`).set({name1:data.name,name2:data.partner,journey:data.journey,budget:data.budget});
    setHousehold(hhId);setNeedsOnboarding(false);
    // Listen
    db.ref(`households/${hhId}/members`).on("value",s=>{const v=s.val();if(v)setMembers(v)});
    db.ref(`households/${hhId}/tasks`).on("value",s=>{if(sk.current){sk.current=false;return}const v=s.val();if(v&&Array.isArray(v))setTasks(v)});
    db.ref(`households/${hhId}/budget`).on("value",s=>{if(bsk.current){bsk.current=false;return}const v=s.val();if(v&&Array.isArray(v))setBudgetItems(v)});
    db.ref(`households/${hhId}/dueDate`).on("value",s=>{const v=s.val();if(v)setDueDate(v)});
    db.ref(`households/${hhId}/profile`).on("value",s=>{const v=s.val();if(v)setProfile(v)});
    db.ref(`users/${u.uid}/secrets`).on("value",s=>{const v=s.val();if(v&&Array.isArray(v))setSecretTasks(v)});
  }

  function signIn(){setAuthErr("");const p=new firebase.auth.GoogleAuthProvider();firebase.auth().signInWithPopup(p).catch(e=>setAuthErr(e.message))}
  function signOut(){firebase.auth().signOut();setUser(null);setHousehold(null);setTasks([]);setBudgetItems([]);setMembers({});setSecretTasks([])}
  function removeMember(uid){if(!confirm("Remove this member?"))return;if(dbRef.current&&household){dbRef.current.ref(`households/${household}/members/${uid}`).remove();dbRef.current.ref(`users/${uid}/householdId`).remove()}}
  async function mergeAccounts(){
    if(!mergeCode.trim()){alert("Paste an invite link or household ID.");return}
    let mhId=mergeCode.trim();
    if(mhId.includes("invite="))mhId=new URL(mhId).searchParams.get("invite");
    if(!mhId){alert("Invalid code.");return}
    try{
      const snap=await dbRef.current.ref(`households/${mhId}/tasks`).once("value");
      const otherTasks=snap.val();
      if(!otherTasks){alert("No account found with that code.");return}
      if(!confirm(`Found ${otherTasks.length} tasks in the other account. Merge them into yours?`))return;
      const maxId=Math.max(0,...tasks.map(t=>t.id));
      const merged=[...tasks,...otherTasks.map((t,i)=>({...t,id:maxId+i+1}))];
      sT(merged);
      // Move other members
      const mSnap=await dbRef.current.ref(`households/${mhId}/members`).once("value");
      const otherMembers=mSnap.val()||{};
      for(const[uid,info]of Object.entries(otherMembers)){
        await dbRef.current.ref(`households/${household}/members/${uid}`).set(info);
        await dbRef.current.ref(`users/${uid}/householdId`).set(household);
      }
      alert("Accounts merged successfully!");setMergeCode("");
    }catch(e){alert("Error merging: "+e.message)}
  }

  async function resetAccount(){
    if(!confirm("Are you sure? This will delete ALL your tasks, budget items, and settings. You'll go through onboarding again."))return;
    if(!confirm("This cannot be undone. Really reset everything?"))return;
    if(dbRef.current&&household){
      await dbRef.current.ref(`households/${household}`).remove();
      await dbRef.current.ref(`users/${user.uid}/householdId`).remove();
      await dbRef.current.ref(`users/${user.uid}/secrets`).remove();
      setHousehold(null);setTasks([]);setBudgetItems([]);setMembers({});setSecretTasks([]);setDueDate("");setProfile({});
      setNeedsOnboarding(true);setShowSettings(false);
    }
  }

  function sT(t){setTasks(t);if(dbRef.current&&household){sk.current=true;dbRef.current.ref(`households/${household}/tasks`).set(t)}}
  function sB(b){setBudgetItems(b);if(dbRef.current&&household){bsk.current=true;dbRef.current.ref(`households/${household}/budget`).set(b)}}
  function sD(d){setDueDate(d);if(dbRef.current&&household)dbRef.current.ref(`households/${household}/dueDate`).set(d)}

  let cw=2;if(dueDate){const du=new Date(dueDate),now=new Date(),diff=Math.ceil((du-now)/(1000*60*60*24*7));cw=Math.max(1,Math.min(40,40-diff))}
  const cm=w2m(cw);

  const vc=CATS;
  const vis=t=>true;
  function sS(s){setSecretTasks(s);if(dbRef.current&&user)dbRef.current.ref(`users/${user.uid}/secrets`).set(s)}
  const memberList=Object.entries(members);
  const myName=memberList.find(([k])=>k===user.uid)?.[1]?.name?.split(" ")[0]||"Me";
  const partnerEntry=memberList.find(([k])=>k!==user.uid);
  const partnerName=partnerEntry?.[1]?.name?.split(" ")[0]||"Partner";
  const ownerOpts=[{key:"all",label:"All"},{key:"me",label:"Me"},{key:"partner",label:partnerEntry?"Partner":"Partner"},{key:"both",label:"Both"}];
  function ownerLabel(o){if(o==="both")return"Both";if(o==="partner1"){const m=memberList[0];return m?m[1].name?.split(" ")[0]:"P1"}if(o==="partner2"){const m=memberList[1];return m?m[1].name?.split(" ")[0]:"P2"}if(o==="me")return myName;if(o==="partner")return partnerName;return o}
  function ownerClass(o){return o==="partner1"||o==="me"?"oj":o==="partner2"||o==="partner"?"ot":"obth"}
  function ownerInitial(o){if(o==="both")return"\u{1F91D}";if(o==="partner1"||o==="me")return myName.charAt(0);if(o==="partner2"||o==="partner")return partnerName.charAt(0);return"?"}

  const ft=tasks.filter(t=>{if(!vis(t))return false;const cm2=cat==="all"||t.cat===cat;
    let om=ofl==="all";
    if(!om){
      const mySlot=memberList[0]&&memberList[0][0]===user.uid?"partner1":"partner2";
      const partnerSlot=mySlot==="partner1"?"partner2":"partner1";
      if(ofl==="me")om=t.owner===mySlot;
      else if(ofl==="partner")om=t.owner===partnerSlot;
      else if(ofl==="both")om=t.owner==="both";
      else om=t.owner===ofl;
    }
    const sm=!q||t.text.toLowerCase().includes(q.toLowerCase());return cm2&&om&&sm});
  const vt=tasks.filter(vis);
  const tot=vt.length,dn=vt.filter(t=>t.status==="done").length,pct=tot?Math.round(dn/tot*100):0;
  const odCnt=vt.filter(t=>t.status!=="done"&&t.week<cw).length;
  const taskCostTotal=vt.reduce((s,t)=>s+(t.cost||0),0);const taskCostSpent=vt.filter(t=>t.status==="done").reduce((s,t)=>s+(t.cost||0),0);
  const onceTotal=budgetItems.filter(b=>b.freq==="once").reduce((s,b)=>s+b.amount,0);
  const monthlyTotal=budgetItems.filter(b=>b.freq==="monthly").reduce((s,b)=>s+b.amount,0);
  const yearProjection=onceTotal+(monthlyTotal*12)+taskCostTotal;
  const pl={high:"Urgent",medium:"Medium",low:"Low"};const pcl={high:"bh",medium:"bm",low:"bl"};
  function uT(id,f){sT(tasks.map(t=>t.id===id?{...t,...f}:t))}
  function cyc(id){const t=tasks.find(x=>x.id===id);if(!t)return;const n=t.status==="todo"?"inprogress":t.status==="inprogress"?"done":"todo";uT(id,{status:n,done:n==="done"})}
  function delT(id){sT(tasks.filter(t=>t.id!==id));setExp(null)}
  function addT(){if(!nt.text.trim())return;const id=Math.max(0,...tasks.map(t=>t.id))+1;sT([...tasks,{...nt,id,done:false,status:"todo",cost:nt.cost?+nt.cost:null}]);setNt({cat:"medical",text:"",week:2,priority:"medium",notes:"",owner:"both",cost:""});setAo(false)}
  function addBI(){if(!nb.name.trim()||!nb.amount)return;const id=Math.max(0,...budgetItems.map(b=>b.id))+1;sB([...budgetItems,{...nb,id,amount:+nb.amount}]);setNb({name:"",amount:"",freq:"once",cat:"medical"})}
  function delBI(id){sB(budgetItems.filter(b=>b.id!==id))}
  const inviteUrl=household?`${window.location.origin}${window.location.pathname}?invite=${household}`:"";
  function copyInvite(){navigator.clipboard.writeText(inviteUrl);setCopied(true);setTimeout(()=>setCopied(false),2000)}

  // AUTH SCREEN
  if(loading)return<div className="auth-screen"><div className="auth-box"><div className="logo">{"\u{1F476}"}</div><div style={{color:"var(--g1)"}}>Loading...</div></div></div>;
  if(!user)return(<div className="auth-screen"><div className="auth-box">
    <div className="logo">{"\u{1F476}"}</div><h1>Baby CRM</h1>
    <div className="sub">Your pregnancy command center. Sign in to start planning together.</div>
    <button className="g-btn" onClick={signIn}><svg viewBox="0 0 24 24"><path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92a5.06 5.06 0 0 1-2.2 3.32v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.1z"/><path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/><path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/><path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/></svg>Sign in with Google</button>
    {authErr&&<div className="auth-err">{authErr}</div>}
  </div></div>);

  // ONBOARDING
  if(needsOnboarding)return<Onboarding user={user} onComplete={completeOnboarding}/>;

  // TASK CARD
  function TC({task:t}){
    const ex=exp===t.id;const isOd=t.status!=="done"&&t.week<cw;
    const sc=t.status==="done"?"done":t.status==="inprogress"?"prog":"";
    return(<div className={`tc${t.status==="done"?" dn":""}${isOd?" od":""}`} onClick={()=>setExp(ex?null:t.id)}>
      <div className="tc-top">
        <div className={`ck ${sc}`} onClick={e=>{e.stopPropagation();cyc(t.id)}}>{t.status==="done"&&<span>&#10003;</span>}{t.status==="inprogress"&&<span>&#9679;</span>}</div>
        <div className="tc-bd"><div className={`tc-tx${t.status==="done"?" done":""}`}>{t.text}</div>
          <div className="tc-mt"><span className={`bg ${pcl[t.priority]}`}>{pl[t.priority]}</span><span className="bg bw">Wk {t.week}</span>{t.cost!=null&&<span className="bg bc">${t.cost}</span>}{isOd&&<span className="bg bh">Overdue</span>}<div className={`ob2 ${ownerClass(t.owner)}`}>{ownerInitial(t.owner)}</div></div>
        </div><span className={`tc-ar${ex?" op":""}`}>&#9660;</span>
      </div>
      {ex&&<div className="tc-ex" onClick={e=>e.stopPropagation()}>
        <textarea value={t.notes||""} onChange={e=>uT(t.id,{notes:e.target.value})} placeholder="Add notes..."/>
        <div className="er">
          <select value={t.status} onChange={e=>{const s=e.target.value;uT(t.id,{status:s,done:s==="done"})}}><option value="todo">To Do</option><option value="inprogress">In Progress</option><option value="done">Done</option></select>
          <select value={t.owner} onChange={e=>uT(t.id,{owner:e.target.value})}>{ownerOpts.filter(o=>o.key!=="all").map(o=><option key={o.key} value={o.key}>{o.label}</option>)}</select>
          <select value={t.priority} onChange={e=>uT(t.id,{priority:e.target.value})}><option value="high">Urgent</option><option value="medium">Medium</option><option value="low">Low</option></select>
          <input type="number" value={t.cost||""} onChange={e=>uT(t.id,{cost:e.target.value?+e.target.value:null})} placeholder="$"/>
          <button className="bd" onClick={()=>delT(t.id)}>Delete</button>
        </div>
      </div>}
    </div>)}

  // DASHBOARD
  function HomeView(){
    const upcoming=vt.filter(t=>t.status!=="done"&&t.week>=cw).sort((a,b)=>a.week-b.week).slice(0,5);
    const overdue=vt.filter(t=>t.status!=="done"&&t.week<cw).sort((a,b)=>a.week-b.week).slice(0,3);
    const catStats=vc.map(c=>{const ct=vt.filter(t=>t.cat===c.id);const d=ct.filter(t=>t.status==="done").length;return{...c,total:ct.length,done:d}}).filter(c=>c.total>0);
    return(<div>
      <div style={{display:"flex",justifyContent:"space-between",alignItems:"flex-start",flexWrap:"wrap",gap:12,marginBottom:4}}>
        <div>
          <div className="dash-hello">Welcome back{profile.name1?`, ${profile.name1}`:""} {"\u{1F44B}"}</div>
          <div className="dash-sub">Week {cw} &middot; Month {cm} &middot; Trimester {Math.ceil(cm/3)}</div>
        </div>
        <button className="ba" onClick={()=>{setTab("tracker");setAo(true)}}>+ Add Task</button>
      </div>
      <div className="due-row">
        <div><label>Due date </label><input type="date" value={dueDate} onChange={e=>sD(e.target.value)}/></div>
        <span className="wbadge">Week {cw}</span>
        {odCnt>0&&<span className="odue">{odCnt} overdue</span>}
      </div>
      <div className="pbar"><div className="pfill" style={{width:`${pct}%`}}/></div>
      <div className="dash-cards">
        <div className="dash-card accent"><div className="dc-label">Progress</div><div className="dc-val">{pct}%</div><div className="dc-sub">{dn}/{tot} tasks done</div></div>
        <div className="dash-card"><div className="dc-label">This Month</div><div className="dc-val">{vt.filter(t=>w2m(t.week)===cm&&t.status!=="done").length}</div><div className="dc-sub">tasks remaining</div></div>
        <div className={`dash-card${odCnt>0?" warn":""}`}><div className="dc-label">Overdue</div><div className="dc-val">{odCnt}</div><div className="dc-sub">need attention</div></div>
        <div className="dash-card"><div className="dc-label">Budget</div><div className="dc-val">${taskCostSpent.toLocaleString()}</div><div className="dc-sub">of ${taskCostTotal.toLocaleString()}</div></div>
      </div>
      {overdue.length>0&&<div className="dash-section"><div className="dash-section-title">OVERDUE</div><div className="dash-upcoming">{overdue.map(t=><TC key={t.id} task={t}/>)}</div></div>}
      <div className="dash-section"><div className="dash-section-title">COMING UP NEXT</div><div className="dash-upcoming">{upcoming.length?upcoming.map(t=><TC key={t.id} task={t}/>):<div className="empty">All caught up! {"\u{1F389}"}</div>}</div></div>
      <div className="dash-section"><div className="dash-section-title">CATEGORIES</div><div className="dash-cats">{catStats.map(c=>(
        <div key={c.id} className="dash-cat" style={{cursor:"pointer"}} onClick={()=>{setCat(c.id);setTab("tracker")}}>
          <span className="dash-cat-icon">{c.icon}</span>
          <div className="dash-cat-info"><div className="dash-cat-name">{c.label}</div><div className="dash-cat-prog">{c.done}/{c.total} done</div><div className="dash-cat-bar"><div className="dash-cat-fill" style={{width:`${c.total?c.done/c.total*100:0}%`}}/></div></div>
        </div>))}</div></div>
    </div>)}

  function BoardView(){return(<div>{(cat==="all"?vc:vc.filter(c=>c.id===cat)).map(c=>{const ct=ft.filter(t=>t.cat===c.id).sort((a,b)=>a.week-b.week);if(!ct.length)return null;const d=ct.filter(t=>t.status==="done").length;return(<div key={c.id} className="cg"><div className="ch"><span className="ci">{c.icon}</span><span className="cl">{c.label}</span><span className="cc">{d}/{ct.length}</span><div className="cb"><div className="cb-f" style={{width:`${ct.length?d/ct.length*100:0}%`}}/></div></div>{ct.map(t=><TC key={t.id} task={t}/>)}</div>)})}</div>)}
  function KanbanView(){
    const cols=[{key:"todo",label:"TO DO"},{key:"inprogress",label:"IN PROGRESS"},{key:"done",label:"DONE"}];
    return(<div className="kan">{cols.map(col=>{const items=ft.filter(t=>t.status===col.key).sort((a,b)=>a.week-b.week);
      return(<div key={col.key} className={`kcol${dragOver===col.key?" drag-over":""}`} onDragOver={e=>{e.preventDefault();setDragOver(col.key)}} onDragLeave={()=>setDragOver(null)} onDrop={e=>{e.preventDefault();if(dragId!=null)uT(dragId,{status:col.key,done:col.key==="done"});setDragId(null);setDragOver(null)}}>
        <h3>{col.label}<span>{items.length}</span></h3>
        {items.map(t=><div key={t.id} draggable="true" onDragStart={()=>setDragId(t.id)} onDragEnd={()=>{setDragId(null);setDragOver(null)}} className={dragId===t.id?"dragging":""}><TC task={t}/></div>)}
      </div>)})}</div>)}
  function TimelineView(){return(<div className="tl"><div className="tl-tr">{MONTHS.map(mo=>{const mt=ft.filter(t=>w2m(t.week)===mo.m).sort((a,b)=>a.week-b.week);const md=mt.filter(t=>t.status==="done").length;const ic=cm===mo.m;return(<div key={mo.m} className={`tl-mo${ic?" tl-cur":""}`}><div className="tl-mh" style={!ic?{background:"var(--g3)"}:{}}><div className="mm">{mo.label}</div><div className="mw">{mo.weeks}</div><div className="mt">Trimester {mo.tri}</div></div><div className="tl-ln"><div className="tl-lf" style={{width:`${mt.length?md/mt.length*100:0}%`}}/></div><div className="tl-ts">{mt.map(t=><TC key={t.id} task={t}/>)}</div></div>)})}</div></div>)}
  function BudgetView(){
    const catBudgets=vc.map(c=>{const tC=vt.filter(t=>t.cat===c.id);const total=tC.reduce((s,t)=>s+(t.cost||0),0)+budgetItems.filter(b=>b.cat===c.id&&b.freq==="once").reduce((s,b)=>s+b.amount,0);const spent=tC.filter(t=>t.status==="done").reduce((s,t)=>s+(t.cost||0),0);const monthly=budgetItems.filter(b=>b.cat===c.id&&b.freq==="monthly").reduce((s,b)=>s+b.amount,0);return{...c,total,spent,monthly}}).filter(c=>c.total>0||c.monthly>0);
    return(<div>
      <div className="bgt-cards"><div className="bgt-card"><div className="bc-label">Task Costs</div><div className="bc-val">${taskCostTotal.toLocaleString()}</div></div><div className="bgt-card green"><div className="bc-label">Spent</div><div className="bc-val">${taskCostSpent.toLocaleString()}</div></div><div className="bgt-card"><div className="bc-label">Monthly</div><div className="bc-val">${monthlyTotal.toLocaleString()}/mo</div></div><div className="bgt-card"><div className="bc-label">One-Time</div><div className="bc-val">${onceTotal.toLocaleString()}</div></div></div>
      <div className="bgt-proj"><h3>First Year Projection</h3><div className="bgt-proj-grid"><div className="bgt-proj-item"><div className="pv">${taskCostTotal.toLocaleString()}</div><div className="pl">Tasks</div></div><div className="bgt-proj-item"><div className="pv">${onceTotal.toLocaleString()}</div><div className="pl">One-Time</div></div><div className="bgt-proj-item"><div className="pv">${(monthlyTotal*12).toLocaleString()}</div><div className="pl">Annual</div></div></div><div style={{textAlign:"center",marginTop:14,fontSize:18,fontWeight:600}}>Total: <span style={{color:"var(--red)"}}>${yearProjection.toLocaleString()}</span></div></div>
      <div className="bgt-section"><div className="bgt-section-title">BY CATEGORY</div><div className="bgt-cat-grid">{catBudgets.map(c=>(<div key={c.id} className="bgt-cat"><div className="bgt-cat-top"><span className="bgt-cat-name">{c.icon} {c.label}</span><span className="bgt-cat-amt">${(c.total+c.monthly*12).toLocaleString()}</span></div><div className="bgt-cat-bar"><div className="bgt-cat-fill" style={{width:`${c.total?(c.spent/c.total*100):0}%`,background:c.color}}/></div><div className="bgt-cat-detail"><span>${c.spent.toLocaleString()} spent</span>{c.monthly>0&&<span>${c.monthly}/mo</span>}</div></div>))}</div></div>
      <div className="bgt-section"><div className="bgt-section-title">STANDALONE ITEMS</div>
        <div className="bgt-add"><input type="text" placeholder="Item..." value={nb.name} onChange={e=>setNb(p=>({...p,name:e.target.value}))}/><input type="number" placeholder="$" value={nb.amount} onChange={e=>setNb(p=>({...p,amount:e.target.value}))}/><select value={nb.freq} onChange={e=>setNb(p=>({...p,freq:e.target.value}))}><option value="once">One-time</option><option value="monthly">Monthly</option></select><select value={nb.cat} onChange={e=>setNb(p=>({...p,cat:e.target.value}))}>{vc.map(c=><option key={c.id} value={c.id}>{c.icon} {c.label}</option>)}</select><button className="btnp" onClick={addBI}>Add</button></div>
        {budgetItems.map(b=>(<div key={b.id} className="bgt-item"><span>{CATS.find(c=>c.id===b.cat)?.icon}</span><span className="bgt-item-name">{b.name}</span><span className="bgt-item-freq">{b.freq==="monthly"?"Monthly":"One-time"}</span><span className="bgt-item-amt">${b.amount.toLocaleString()}{b.freq==="monthly"&&"/mo"}</span><button className="bgt-item-del" onClick={()=>delBI(b.id)}>&times;</button></div>))}
      </div>
    </div>)}

  return(<div>
    <nav className="app-nav">
      <div className="app-nav-left">
        <div className="app-logo" style={{cursor:"default",userSelect:"none"}}>{"\u{1F476}"} Baby CRM</div>
        <div className="app-tabs">
          {["home","tracker","budget","secrets"].map(t=><button key={t} className={`app-tab${tab===t?" a":""}`} onClick={()=>setTab(t)}>{t==="secrets"?"\u{1F512} Secrets":t.charAt(0).toUpperCase()+t.slice(1)}</button>)}
        </div>
      </div>
      <div className="app-nav-right">
        {memberList.length>=2&&<span className="partner-badge" onClick={()=>setShowMembers(true)}>{"\u{2705}"} {memberList.length} members</span>}
        <div className="user-menu">
          <img className="user-avatar" src={user.photoURL||""} alt="" onClick={()=>setShowMenu(!showMenu)} referrerPolicy="no-referrer"/>
          {showMenu&&<div className="user-drop" onMouseLeave={()=>setShowMenu(false)}>
            <div className="user-drop-info"><strong>{user.displayName}</strong><br/>{user.email}</div>
            <div className="user-drop-divider"/>
            <div className="user-drop-item" onClick={()=>{setShowMembers(true);setShowMenu(false)}}>{"\u{1F465}"} Members ({memberList.length})</div>
            <div className="user-drop-item" onClick={()=>{copyInvite();setShowMenu(false)}}>{"\u{1F517}"} Copy invite link</div>
            <div className="user-drop-item" onClick={()=>{setShowSettings(true);setShowMenu(false)}}>{"\u{2699}\u{FE0F}"} Settings</div>
            <div className="user-drop-divider"/>
            <div className="user-drop-item" onClick={()=>{window.location.href="mailto:jasonsingh826@gmail.com?subject=Baby CRM Feedback";setShowMenu(false)}}>{"\u{1F4AC}"} Send feedback</div>
            <div className="user-drop-divider"/>
            <div className="user-drop-item danger" onClick={signOut}>Sign out</div>
          </div>}
        </div>
      </div>
    </nav>

    {copied&&<div className="toast t2">Copied!</div>}

    <div className="cnt">
      <div className={`sync-bar ${conn?"on":"off"}`}><div className={`sd ${conn?"on":"off"}`}/>{conn?"Live sync":"Reconnecting..."}</div>

      {memberList.length<2&&tab==="home"&&<div className="invite-banner">
        <div className="ib-text">Invite your partner<span>Share this link to plan together</span></div>
        <div className="invite-link"><input readOnly value={inviteUrl}/><button onClick={copyInvite}>{copied?"Copied!":"Copy"}</button></div>
      </div>}

      {tab==="home"&&<HomeView/>}

      {tab==="tracker"&&<>
        <div className="ctrls">
          <div className="ctrls-l">{["board","kanban","timeline"].map(v=><button key={v} className={`vb${trackerView===v?" a":""}`} onClick={()=>setTrackerView(v)}>{v.charAt(0).toUpperCase()+v.slice(1)}</button>)}</div>
          <div className="ctrls-r"><input className="si" placeholder="Search..." value={q} onChange={e=>setQ(e.target.value)}/><button className="ba" onClick={()=>setAo(!ao)}>+ Add</button></div>
        </div>
        {ao&&<div className="af"><div className="atl">New Task</div>
          <input type="text" placeholder="What needs to be done?" value={nt.text} onChange={e=>setNt(p=>({...p,text:e.target.value}))}/>
          <div className="rw"><select value={nt.cat} onChange={e=>setNt(p=>({...p,cat:e.target.value}))}>{vc.map(c=><option key={c.id} value={c.id}>{c.icon} {c.label}</option>)}</select><input type="number" min="1" max="40" value={nt.week} onChange={e=>setNt(p=>({...p,week:+e.target.value}))} placeholder="Wk"/><select value={nt.priority} onChange={e=>setNt(p=>({...p,priority:e.target.value}))}><option value="high">Urgent</option><option value="medium">Medium</option><option value="low">Low</option></select><select value={nt.owner} onChange={e=>setNt(p=>({...p,owner:e.target.value}))}>{ownerOpts.filter(o=>o.key!=="all").map(o=><option key={o.key} value={o.key}>{o.label}</option>)}</select><input type="number" value={nt.cost} onChange={e=>setNt(p=>({...p,cost:e.target.value}))} placeholder="$"/><button className="btnp" onClick={addT}>Add</button></div>
        </div>}
        <div style={{fontSize:11,fontWeight:700,letterSpacing:"1px",textTransform:"uppercase",color:"var(--g1)",marginBottom:6}}>Categories</div>
        <div className="frow"><button className={`fb${cat==="all"?" a":""}`} onClick={()=>setCat("all")}>All</button>{vc.map(c=><button key={c.id} className={`fb${cat===c.id?" a":""}`} onClick={()=>setCat(c.id)}>{c.icon} {c.label}</button>)}</div>
        <div style={{fontSize:11,fontWeight:700,letterSpacing:"1px",textTransform:"uppercase",color:"var(--g1)",marginBottom:6,marginTop:10}}>Owner</div>
        <div className="frow" style={{marginBottom:16}}>{ownerOpts.map(o=><button key={o.key} className={`fb${ofl===o.key?" a":""}`} onClick={()=>setOfl(o.key)}>{o.label}</button>)}</div>
        {trackerView==="board"&&<BoardView/>}
        {trackerView==="kanban"&&<KanbanView/>}
        {trackerView==="timeline"&&<TimelineView/>}
        {ft.length===0&&<div className="empty">No tasks found.</div>}
      </>}

      {tab==="budget"&&<BudgetView/>}

      {tab==="secrets"&&<div>
        <div style={{display:"flex",justifyContent:"space-between",alignItems:"flex-start",flexWrap:"wrap",gap:12,marginBottom:4}}>
          <div>
            <div style={{fontSize:28,fontWeight:600,letterSpacing:"-1px",marginBottom:4}}>{"\u{1F512}"} My Secret Reminders</div>
            <div style={{fontSize:14,color:"var(--g1)",marginBottom:8,lineHeight:1.6}}>Only visible to you. Nothing here is shared.</div>
          </div>
        </div>
        <div style={{display:"flex",gap:8,marginBottom:20}}>
          <input className="si" style={{flex:1,width:"auto"}} placeholder="Add a secret reminder..." value={secretInput} onChange={e=>setSecretInput(e.target.value)} onKeyDown={e=>{if(e.key==="Enter"&&secretInput.trim()){const id=Math.max(0,...secretTasks.map(s=>s.id))+1;sS([...secretTasks,{id,text:secretInput.trim(),done:false,notes:""}]);setSecretInput("")}}}/>
          <button className="ba" onClick={()=>{if(!secretInput.trim())return;const id=Math.max(0,...secretTasks.map(s=>s.id))+1;sS([...secretTasks,{id,text:secretInput.trim(),done:false,notes:""}]);setSecretInput("")}}>+ Add</button>
        </div>
        {secretTasks.map((s,i)=><div key={s.id} className="tc" style={{borderLeft:s.done?"none":"3px solid var(--pnk)"}}>
          <div className="tc-top">
            <div className={`ck${s.done?" done":""}`} onClick={()=>{const u2=[...secretTasks];u2[i]={...s,done:!s.done};sS(u2)}}>{s.done&&<span>&#10003;</span>}</div>
            <div className="tc-bd">
              <div className={`tc-tx${s.done?" done":""}`}>{s.text}</div>
              {exp===`s-${s.id}`&&<div className="tc-ex" onClick={e=>e.stopPropagation()}>
                <textarea value={s.notes||""} onChange={e=>{const u2=[...secretTasks];u2[i]={...s,notes:e.target.value};sS(u2)}} placeholder="Add a private note..."/>
                <div className="er"><button className="bd" onClick={()=>{sS(secretTasks.filter(x=>x.id!==s.id));setExp(null)}}>Delete</button></div>
              </div>}
            </div>
            <span className={`tc-ar${exp===`s-${s.id}`?" op":""}`} onClick={()=>setExp(exp===`s-${s.id}`?null:`s-${s.id}`)}>&#9660;</span>
          </div>
        </div>)}
        {secretTasks.length===0&&<div className="empty">No secret reminders yet. Type one above!</div>}
      </div>}
    </div>

    {showMembers&&<div className="modal-overlay" onClick={()=>setShowMembers(false)}>
      <div className="modal" onClick={e=>e.stopPropagation()}>
        <div className="modal-hdr"><h2>Members</h2><button className="modal-close" onClick={()=>setShowMembers(false)}>&times;</button></div>
        <div className="modal-body">
          <div className="member-count">{memberList.length} member{memberList.length!==1?"s":""}</div>
          {memberList.map(([uid,m])=>(<div key={uid} className="member-card">
            {m.photo?<img className="member-photo" src={m.photo} referrerPolicy="no-referrer"/>:<div className="member-photo-placeholder">{m.name?.charAt(0)||"?"}</div>}
            <div className="member-info"><div className="member-name">{m.name||"Unknown"}</div><div className="member-email">{m.email||""}</div>{uid===household&&<div className="member-role">Owner</div>}</div>
            {uid===user.uid?<span className="member-you">You</span>:user.uid===household&&<button className="member-remove" onClick={()=>removeMember(uid)}>Remove</button>}
          </div>))}
          <div className="invite-section"><div className="invite-section-title">Invite someone</div><div className="sub2">Share this link to add a partner.</div><div className="invite-row"><input readOnly value={inviteUrl}/><button onClick={copyInvite}>{copied?"Copied!":"Copy"}</button></div></div>
        </div>
      </div>
    </div>}

    {showSettings&&<div className="modal-overlay" onClick={()=>setShowSettings(false)}>
      <div className="modal" onClick={e=>e.stopPropagation()}>
        <div className="modal-hdr"><h2>Settings</h2><button className="modal-close" onClick={()=>setShowSettings(false)}>&times;</button></div>
        <div className="modal-body">
          <div className="invite-section" style={{marginTop:0,paddingTop:0,borderTop:"none"}}>
            <div className="invite-section-title">Merge accounts</div>
            <div className="sub2">If your partner already has their own Baby CRM account, paste their invite link here to combine both task lists and members into one shared planner.</div>
            <div className="invite-row"><input value={mergeCode} onChange={e=>setMergeCode(e.target.value)} placeholder="Paste invite link..."/><button onClick={mergeAccounts}>Merge</button></div>
          </div>
          <div className="merge-section">
            <div className="invite-section-title" style={{color:"var(--red)"}}>Reset account</div>
            <div className="sub2">Delete all your tasks, budget items, and settings. You'll go through onboarding again from scratch. This cannot be undone.</div>
            <button className="member-remove" onClick={resetAccount}>Reset everything</button>
          </div>
        </div>
      </div>
    </div>}

    <footer className="ftr">&copy; 2026 Baby CRM</footer>
  </div>)}

ReactDOM.createRoot(document.getElementById("app")).render(<App/>);
</script>
</body>
</html>
